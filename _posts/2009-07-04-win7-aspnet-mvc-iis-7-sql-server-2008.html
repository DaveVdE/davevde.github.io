---
layout: post
title: Win7, ASP.NET MVC, IIS 7, SQL Server 2008
date: '2009-07-04T07:18:00.002+02:00'
author: Dave Van den Eynde
tags: 
modified_time: '2009-09-19T14:03:44.930+02:00'
blogger_id: tag:blogger.com,1999:blog-10546079.post-2036783692819588327
blogger_orig_url: http://www.groovbird.com/2009/07/win7-aspnet-mvc-iis-7-sql-server-2008.html
---

<p>While setting up my development machine for the coming weeks, I needed to make a number of tough decisions. The first decision was whether to go with SQL Server 2005 or SQL Server 2008. I figured it was not a bad thing to go with the lastest version for new development. I remember there was an issue with Visual Studio 2008 integrating with SQL Server 2008, but that seemed to be fixed in Visual Studio 2008 SP1. </p>  <p>The next decision was whether to go with SQL Server Express or Standard. I chose the latter, simply because it's a different environment and if I'm going to test my app with a &quot;real&quot; server I might as well start to use it in development as well. </p>  <p>The final decision to make was whether to use the development web server included with VS2008 or go with IIS7. Again, I chose the latter for the aforementioned reasons: if I'm going to deploy to IIS7, I might as well debug it in IIS7 as well. That will tell me about the kind of problems I might run into before I go into &quot;production&quot;. </p>  <p>Seems that a number of those problems already found me while trying to use the simplest ASP.NET MVC project possible: File&gt;Create New. Compile. Run. <em>Fail</em>. </p>  <p>The problem was that it was impossible to register with the new website. ASP.NET MVC out of the box uses the ASP.NET MembershipProvider to offer signup/login functionality. Which is cool. But of course, it won't work out of the box when you're using the SQL Server 2008 Standard edition. </p>  <p>The first issue is that the Standard edition doesn't support attached databases. So creating a new database file (.mdf) won't work. That also means that no such database is ready when you're running for the first time. You'll have to make it yourself. That one is easy: ASP.NET comes with a nice <a href="http://msdn.microsoft.com/en-us/library/x28wfk74.aspx">tool</a> that does this for you on any database of your choosing. I knew that! So I opened SQL Server Management Studio, created a new database (I called it &quot;aspnetdb&quot;. Aptly. Very aptly.) and used the aspnet_regsql tool to create the required schema in there. </p>  <p>Then, I changed the connection string in Web.config to use this database. I kept the integrated security on (anyone still using &quot;mixed mode security&quot; should be dragged onto the street and shot). So then it worked. But only when using the development webserver. Because that uses my personal account to connect to SQL Server, and I happen to be database administrator (at least, that's what SQL Server tells me) so it can connect and do all of its stuff just fine.</p>  <p>When you use IIS 7, it uses the identity of the app pool of your web app to connect to SQL Server. That's also an easy guess. The problem is that in Windows 7, there's some weirdness about what user account is used exactly to that purpose. SQL Server will report a failed login for &quot;IIS APPPOOL\DefaultAppPool&quot;. But I couldn't find such a user. While I was googling, I came across a number of sites advising me to switch it back to using Network Service for the DefaultAppPool, but I knew there had to be a better way. The weirdness ended when I took a leap of faith: I added a login named IIS APPPOOL\DefaultAppPool without checking the name. That worked. </p>  <p>After that, I made it dbo of the aspnetdb database (which is probably too much, but it'll do for now) and then everything went smoothly. This is exactly the sort of problems I was hoping to encounter before actually deploying. So my plan worked!</p>  